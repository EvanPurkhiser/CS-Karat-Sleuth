#!/usr/bin/env ruby

# Handle passing in argv to either the learning part of the program or the
# checker part of the program. Comamand line arguments range from 0 to 3

require 'mail'

# Expected input for error messages
expectedArg = "Possible inputs:
  karatsleuth 
  karatsleuth <classified-dir>
  karatsleuth <unclassified-dir> {spam,ham}"

# Set data directory to project root by default
dataDir = File.expand_path("../training/", Dir.pwd)

if ARGV.length > 2
	puts "Too many arguments. " + expectedArg
	exit
end

# If given the directory, look for separated ham/spam folders with emails
haveHam = true
haveSpam = true
if ARGV.length >= 1
	dataDir = ARGV[0]
	hamDir = dataDir + "/ham"
	spamDir = dataDir + "/spam"
	unless File.directory? hamDir
		haveHam = false
	end
	unless File.directory? spamDir
		haveSpam = false
	end
end

# The directory could have either ham, spam, or both.
if !haveSpam && !haveHam
	puts "Could not find spam or ham directory. " + expectedArg
	exit
end

# If the directory has been classified as ham/spam
if ARGV.length == 2
	dataType = ARGV[1]
	if dataType != "spam" && dataType != "ham"
		puts "Invalid argument. " + expectedArg
		exit
	end
end

# Verify existence of training data
unless File.directory? dataDir
	puts dataDir + ": No such directory. " + expectedArg
	exit
end

# This should probably be in the library instead
# Read in each item within the directory

# Classify ham data sets
if haveHam
	Dir.foreach(hamDir) do |item|
		next if item == '.' or item == '..'
		data = "#{hamDir}/#{item}"
		mail = Mail.read(data)
		# Use contents of ham mail to add into knowledge base
	end
end

# Classify spam data sets
if haveSpam
	Dir.foreach(spamDir) do |item|
		next if item == '.' or item == '..'
		data = "#{spamDir}/#{item}"
		mail = Mail.read(data)
		# Use contents of spam mail to add into knowledge base
	end
end

